function getUrlParameters(){for(var e=window.location.search.substr(1).split("&"),t=0;t<e.length;++t){var a=e[t].split("=",2);params[a[0]]=1==a.length?"":decodeURIComponent(a[1].replace(/\+/g," "))}console.log(params),/[?&]hzUserId=/.test(location.href)&&(user_id=params.hzUserId),proj_id=/[?&]hzProjectId=/.test(location.href)?params.hzProjectId:"-K0h7MU7M5U9K6ZKgi3I",/[?&]hzLeadId=/.test(location.href)?(lead_id=params.hzLeadId,web_lead=0,getLeadInfo()):generateWebLead()}function getPage(e){var t="pg"+e+"_title",a="pg"+e+"_content";$("#pg_title").text(hz_content[t]),$("#pg_content").html(parseToBullet(hz_content[a])),pages_visited+=","+e.toString();var o=new Object;o.pagesVisited=pages_visited,$("#hz-next").off("click").on("click",function(){if(total_pages>e&&getPage(e+1),e==total_pages)if(null==sessionStorage.getItem("show_photos"))showPhotoPopup();else{$.get("photos.html",function(e){$("#ad_div").hide(),$("#property_content").empty(),$("#property_content").append(e)}),pages_visited+=",p";var t=new Object;t.pagesVisited=pages_visited}}),$("#hz-prev").off("click").on("click",function(){e>1&&getPage(e-1)}),1==e?$("#hz-prev").prop("disabled",!0):$("#hz-prev").prop("disabled",!1)}function parseToBullet(e){var t=e.split("."),a="";if(t.length>0){a='<ul style="width: 80%; margin: auto; font-size: 16px;">';for(var o="",n=0;n<t.length;n++)o=$.trim(t[n]),""!=o&&(a+="<li>"+o+"</li><br>");a+="</ul>"}return a}function getSurveySet(e){var t="set_"+e,a=survey_data[Object.keys(survey_data)[0]];for(var o in a)if(a.hasOwnProperty(o)&&o==t)return a[o]}function showSurveyPopup(e){lead_name=document.getElementById("lead_name").value,""==lead_name&&(lead_name="Guest"),console.log("lname:"+lead_name),console.log("set_num="+e);var t=getSurveySet(e),a="set_"+e,o=t.question;1==e&&(o=o.replace("<placeholder>",lead_name));var n=t.choices;console.log(t);var s=document.createElement("div");s.setAttribute("data-role","header"),s.setAttribute("role","banner"),s.className="ui-header ui-bar-inherit";var i=document.createElement("h4");i.className="ui-content",i.setAttribute("role","main"),i.appendChild(document.createTextNode(o)),s.appendChild(i);for(var r=s.outerHTML,d="",l=1;l<n.length;l++){var c=document.createElement("div");c.className="checkbox form-inline",c.setAttribute("style","display:flex;");var p=document.createElement("input");p.setAttribute("type","radio"),p.setAttribute("name",a),p.setAttribute("id","rbtn_"+l),p.setAttribute("value",l),c.appendChild(p),p.onclick=function(){document.getElementById("pr_ok").disabled=!1};var u=document.createElement("label");u.setAttribute("for","rbtn_"+l),u.innerHTML=n[l],c.appendChild(u),d+=c.outerHTML}var _=document.createElement("a");_.id="pr_ok",_.setAttribute("data-role","button"),_.setAttribute("data-rel","back"),_.className="ui-btn ui-shadow ui-corner-all ui-btn-b",_.appendChild(document.createTextNode("OK")),$("#hz_popup").empty(),$("#hz_popup").append(r+d+_.outerHTML),$("#pr_ok").on("click",function(t){console.log(e+":"+total_sets);var o=$("input[name="+a+"]:checked").val();console.log("so:"+o),o="undefined"==typeof o?"0":o,survey_results[a]=o,total_sets>e?(t.stopPropagation(),showSurveyPopup(e+1)):(updateSurveyResults(),document.getElementById("ad_img").src="css/images/springfields_comp.jpg",$("#nav_div").show(),$("#hz-prev").prop("disabled",!0),$("#hz-next").off("click").on("click",function(){$("#ad_div").hide(),$("#property_content").show(),showProjectInfo()})),1==e&&getProjectInfo()}),$("#hz_popup").popup("open")}function updatePriceRange(){for(var e=$("input[name=pr_range]:checked"),t="",a=0;a<e.length;a++)t+=e[a].value+",";if(""!=t){t=t.substring(0,t.length-1);var o=new Object;o.priceRange=t,updateMetrics(o)}}function showPhotoPopup(){var e='<div data-role="header" role="banner" class="ui-header ui-bar-inherit"><h1 class="ui-title" style="font-size: 25px;" role="heading" aria-level="1">Photos</h1></div><div data-role="main" class="ui-content"><h3 class="text-primary text-center">Would you like to see photos of the property?</h3><div class="text-center" style="margin-top: 10px; margin-bottom: 10px;"><a id="hz-yes" style="background: white; color: #337ab7;" data-rel="back" class="ui-btn ui-shadow ui-corner-all">Yes !</a><a id="hz-no" data-rel="back" class="ui-btn ui-shadow ui-corner-all ui-btn-b">No, Thanks !</a></div></div>';$("#hz_popup").empty(),$("#hz_popup").append(e),$("#hz_popup").popup("open")}function getProjectInfo(){var e={project_id:proj_id,lead_id:lead_id},t=HZ_HOST+"/get_project";$.ajax({type:"POST",url:t,data:e,dataType:"json",async:!0,success:function(e){e&&(hz_content=e,console.log(hz_content))}}),0==web_lead&&getMetrics()}function showProjectInfo(){total_pages=hz_content.total_pages,min_percent=100/total_pages,pages_visited=""==pages_visited?"1":pages_visited+",1";var e=new Object;e.pagesVisited=pages_visited,$("#pg_title").text(hz_content.pg1_title),$("#pg_content").html(parseToBullet(hz_content.pg1_content)),$("#hz-prev").prop("disabled",!0),$("#hz-next").prop("disabled",!1),$("#hz-next").off("click").on("click",function(){getPage(2)})}function getMetrics(){var e={project_id:proj_id,lead_id:lead_id},t=HZ_HOST+"/get_metrics";$.ajax({type:"POST",url:t,data:e,dataType:"json",async:!0,success:function(e){var t=0;e?(pages_visited=""==e.pagesVisited?"1":e.pagesVisited+",1",t=""==e.visitCount?0:parseInt(e.visitCount),t+=1):(pages_visited="1",t=1);var a=new Object;a.visitedMicrosite="true",a.visitCount=t.toString(),updateMetrics(a)}})}function updateMetrics(e){var t={project_id:proj_id,lead_id:lead_id,web_lead:web_lead},a=HZ_HOST+"/update_metrics";t.metrics=JSON.stringify(e),$.ajax({type:"POST",url:a,data:t,dataType:"json",async:!0,success:function(){}})}function updateVisitorCount(){var e={project_id:proj_id},t=HZ_HOST+"/update_visitor_count";$.ajax({type:"POST",url:t,data:e,dataType:"json",async:!0,success:function(){}})}function getSurveyData(){var e={project_id:proj_id},t=HZ_HOST+"/get_survey_data";$.ajax({type:"POST",url:t,data:e,dataType:"json",async:!0,success:function(e){e&&(survey_data=e,console.log(survey_data),total_sets=survey_data[Object.keys(survey_data)[0]].total_sets,survey_id=survey_data[Object.keys(survey_data)[0]].id,console.log("total_sets:"+total_sets))}})}function updateSurveyResults(){var e={project_id:proj_id,lead_id:lead_id,lead_name:lead_name,survey_id:survey_id},t=HZ_HOST+"/update_survey_data";console.log("survey_results:"+survey_results),e.results=JSON.stringify(survey_results),$.ajax({type:"POST",url:t,data:e,dataType:"json",async:!0,success:function(e){}})}function generateWebLead(){var e={project_id:proj_id},t=HZ_HOST+"/generate_web_lead";$.ajax({type:"POST",url:t,data:e,dataType:"json",async:!0,success:function(e){e&&(console.log(e),lead_id=e.web_lead_id)}})}function saveLeadDetails(){var e=document.getElementById("lead_email").value,t=document.getElementById("lead_phone").value,a="Yes";null==sessionStorage.getItem("price_sheet_requested")&&(a="No");var o={project_id:proj_id,price_sheet_requested:a,lead_id:lead_id,lead_name:lead_name,lead_email:e,lead_phone:t},n=HZ_HOST+"/save_lead_details";console.log(o),$.ajax({type:"POST",url:n,data:o,dataType:"json",async:!0,success:function(){}})}function getLeadInfo(){var e={project_id:proj_id,lead_id:lead_id},t=HZ_HOST+"/get_lead_info";$.ajax({type:"POST",url:t,data:e,dataType:"json",async:!1,success:function(e){e&&(lead_name=e.lead_name,""!=lead_name&&(document.getElementById("lead_name").value=lead_name,$("#enter_the_dragon").removeAttr("disabled")))}})}var HZ_HOST="http://howzapp.herokuapp.com",hz_content="",total_pages=0,min_percent=0,proj_id="",lead_id="",user_id="",lead_name="",params={},pages_visited="",survey_data="",survey_results={},total_sets,survey_id=0,web_lead=1;